<div ng-include="'dashboard/header.html'"></div>

<h3 id="report" style="margin-top:10px;height:20px;">{{ currentReport }}</h1>
<div ng-if="snapshot.isRunning" class="alert alert-warning">
	<p class="lead">Still Running...</p>
	Snapshot is still going through production.
	<a class="btn btn-default" ng-click="reloadSnapshot()">Refresh</a>
	<a class="btn btn-danger" ng-click="abortSnapshot()">Abort</a>
</div>

<div class="row" id="report-charts">
	<div class="col-md-3">
		<div id="nav">
			<div class="tree" onmouseover="document.body.style.overflow='hidden';" onmouseout="document.body.style.overflow='auto';">
				<div ng-include="'dashboard/nav.html'" ng-model="nav"></div>
			</div>
		</div>
	</div>

	<div ng-if="reportLoadError" class="col-md-10">
		<div class="alert alert-danger">
			<p class="lead">Report Not Found</p>
			{{ reportLoadError }}
		</div>
	</div>

	<div ng-if="!reportLoadError">
	<div ng-show="loading && html" class="col-md-10">
		<img src="dashboard/images/loading.gif">
	</div>
	<div class="col-md-9" ng-show="html">
		<div ng-bind-html="html"></div>
	</div>
	<div class="col-md-9" ng-hide="html">
		<tabset>
			<tab>
				<tab-heading style="font-size:18pt;">
					<i class="fa fa-table"></i>
				</tab-heading>
				<table class="table table-striped" style="text-align:right;">
					<tr>
						<th style="text-align:center" ng-repeat="tableHeader in tableHeaders">{{ tableHeader }}</th>
					</tr>
					<tr ng-repeat="tableRow in tableRows">
						<td ng-repeat="tableData in tableRow track by $index">{{ tableData }}</td>
					</tr>
				</table>
			</tab>
			<tab id="histogram_container">
				<tab-heading style="font-size:18pt;">
					<i class="fa fa-bar-chart"></i>
				</tab-heading>
				<div class="chart">
					<div id="histogram" style="width:800px;"></div>
					<div id="slider"></div>
				</div>
			</tab>
			<tab id="scatter_plot_container">
				<tab-heading style="font-size:18pt;">
					<i class="fa fa-area-chart"></i>
				</tab-heading>
				<div class="chart">
					<div id="scatter_plot" style="width:800px;"></div>
				</div>
			</tab>
		</tabset>
	</div>
</div>

<script>
	function renderCharts(json) {
		var report_chart = new ReportChart(json);
		var x_numeric = report_chart.axisIsNumeric("x");
		var y_numeric = report_chart.axisIsNumeric("y");

		if (x_numeric && y_numeric) {
			$("#scatter_plot_container").show();
			$("#histogram_container").show();

			report_chart.scatterPlot("scatter_plot");
			report_chart.histogram("histogram", Math.sqrt(json.data.length, 1/3));

			$("#slider").slider({
				min: 1,
				max: json.data.length,
				value: Math.sqrt(json.data.length, 1/3),
				slide: function(event, ui) {
					report_chart.histogram("histogram", ui.value);
				}
			});
		}
		else if (x_numeric || y_numeric) {
			$("#histogram_container").show();
			$("#scatter_plot_container").hide();

			report_chart.histogram("histogram", json.data.length);
		}
		else {
			$("#histogram_container").hide();
			$("#scatter_plot_container").hide();
		}

		$('#nav').affix({
			offset: {
				top: $('#nav').offset().top
			}
		});
	}
</script>
